# Kanade 电子负载仪 - 用户使用指南

欢迎使用由 光阪电气 提供的 Kanade 电子负载仪，本文档将介绍本产品的使用方法和注意事项，请在使用前仔细阅读本文档。

> 产品源代码可在 [此处](https://github.com/yanke928/Kanade) 找到。

## 产品概述
- 全开源固件（GPL协议），欢迎在遵守GPL协议的前提下借鉴代码
- 支持OTA升级，无需任何下载器和软件，直接将固件拷入内部 Flash 或 SD 卡即可升级固件
- 带读卡器功能，USB 连接电脑直接读取数据
- 全界面支持简体中文，繁体中文，英语，日语
- 支持多种曲线记录，可直接在设备上记录并查 看以下曲线
	- 电压、电流曲线
	- 电子负载步进测试曲线
	- USB D+ D- 曲线 

## 使用指南
本用户指南中，所使用的术语解释如下：

- 前端电源：被测电源
- 后端负载：接在 USB 输出口的负载
- 左键：拨轮按键左拨
- 中键：直接按下拨轮按键
- 右键：拨轮按键右拨
- 长按：按住按键时间长于 1s
- 双击：指 200ms 内连续两次按下按键

### 主界面
![主界面](https://ooo.0o0.ooo/2016/08/24/57bdacfdefe13.bmp)

使用 5V 电源给设备供电，初始化完成后将进入主界面。

如图所示，主界面第一行显示当前的电 流和电压，第二行分别显示功率和当前MOS管的温度，左下侧显示当前的系统时间，右下侧显 示当前的 D+ D- 电压以及星期。

在未接入前端电源时， D+ D- 脚处于浮空状态，此时它们的电压是不确定的，因此此时 D+ D- 上有随机电压属于正常现象。

![主界面](https://ooo.0o0.ooo/2016/08/24/57bdacfe0826f.bmp)

如图所示，若设备已连接到前端电源， 主界面右下角将交替显示 D+ D- 电压和前端电源可能支持的快速充电协议类型。

![温度](https://ooo.0o0.ooo/2016/08/24/57bdacfdf11b4.bmp)

如图所示，若设备已连接外部温度传感器，主界面将同时显示外部温度和 MOS 管温度。


如图所示，在记录模式或负载模式下， 主界面左下角将显示当前的统计信息（容量及能量），右下角显示记录模式或负载模式的持续时间。

### 时钟界面

![时钟界面](https://ooo.0o0.ooo/2016/08/24/57bdab3014db0.bmp)

在系统闲置一段时间后，系统将进入待机时钟模式（也可以设置永不进入）。待机时钟下，任何按键操作都可以返回主界面。若待机时钟被禁用，则设备永远停留在主界面。

待机模式下，自身功耗极低，为 25mA 左右，非常适合作为电子钟使用。时钟所显示的温度基本准确，可以满足日常使用。

### 确认界面
[图片]
从主界面进入任何模式都会有如图所示的确认界面，用户可以通过左右键选择确定或取消。

在此次说明之后， 本指南将忽略这个确认界面。

## 设备功能
### 快速充电触发
本设备支持 QC 2.0 5V / 9V / 12V / 20V，QC 3.0 任意电压，MTK-PE 任意电压的快速充电触发（诱骗）。

![快充模式选择](https://ooo.0o0.ooo/2016/08/24/57bdac263c382.bmp)

在主界面长按左键，可以进入快充触发模式。用户可以选择需要触发的协议。 进入触发模式后，设备默认不会主动触发任何电压，屏幕右侧会显示当前的电压和电流，作为触发是否成功的参考。
> **警告** 在快充触发模式下，请勿接入不支持高压的后端负载（如非快充手机），以防设备烧毁。

#### QC 2.0

![QC 2.0](https://ooo.0o0.ooo/2016/08/24/57bda31bd93c9.bmp)

通过左右键选择电压，然后按中键确认触发， 触发后的界面如下图。

![QC 2.0 12V](https://ooo.0o0.ooo/2016/08/24/57bda31be0b63.bmp)

> *提示* 由于 QC 协议的局限，初次触发后需要 2 秒握手时间才能得到指定电压。在选择电压后，需要等待触发成功，才可继续触发其他电压。在触发成功前，如果触发其他电压，可能会导致触发失败或出现不可预料的结果。

#### QC 3.0
在 QC 3.0 触发模式下，用户可以通过左右键任意加减快速充电电压（QC 3.0协议规定为 0.2V 一阶）。

![QC 3.0](https://ooo.0o0.ooo/2016/08/24/57bda31bdfe55.bmp)

按住右键发出电压增加指令。

![QC 3.0 6.9V](https://ooo.0o0.ooo/2016/08/24/57bda31bf41e6.bmp)

电压增加成功。

 > *提示* QC 3.0 模式同样需要 2 秒左右的握手时间。

#### MTK-PE
![MTK-PE](https://ooo.0o0.ooo/2016/08/24/57bda31bb3502.bmp)

MTK-PE 模式类似 QC 3.0，可以通过按键自行增减电压。

> **警告**  MTK-PE 协议并没有规定充电头支持的电压规格。发送加压命令后，电压可能会增至 7V 或 9V。

> *提示*  MTK-PE 协议中，充电头和设备直接通过负载电流通讯。在触发过程中观察到电流跳动，属正常现象。
 
MTK-PE 时序标准中，电压上升及下降时序均为 1.5 秒左右，每一次调节电压至少要 1.5 秒后才能得到指定电压。

![接入负载](https://ooo.0o0.ooo/2016/08/24/57bda31bdb8de.bmp)

退出 MTK-PE 触发模式前，设备将提示“接入负载”。如果希望保持 MTK-PE 触发，请在此时连接负载。请不要接入不支持高压的负载。如果不接入负载，电压将会回落 5V。


### 退出触发模式
要退出触发界面，请双击中键。退出后，设备将回到主界面，但 QC 2.0、QC 3.0 触发的电压依然保持，用户可以在此电压下进行测试，或连接负载。

#### 释放快充触发
若用户希望释放 QC 2.0 / QC 3.0 所触发的快充电压，可以再次长按左键。

![释放快充](https://ooo.0o0.ooo/2016/08/24/57bdac25e94dc.bmp)

确认后，设备将释放已触发的快速充电模式，电压会即刻回落到 5V。

### 电流电压绘图
绘图支持：
- 电流电压
- USB D+ D-

在主界面单击中键可以进入动态电流电压绘制模式。

![绘图](https://ooo.0o0.ooo/2016/08/24/57bda5db5b53c.bmp)

如图所示，图像量程默认为 0 - 12V，0 - 2A， 若绘制期间出现高于 12V 的电压或高于 2A 的电流，系统会自动调整量程。

![D+ / D-](https://ooo.0o0.ooo/2016/08/24/57bda5db641d7.bmp)

长按中键，可以在使图像在 D+ D- 和电流电压之间切换。短按中键，可以回到主界面。若无按键操作，系统将持续滚动绘制。

### 记录模式
可以使用内部存储器或 TF 卡，记录实时电流电压信息，并在结束记录时查看容量能量等统计信息。

> *提示* 本设备内部存储器的容量为 8 MB，足够记录大量离线数据。用户亦可插入 TF 卡来存储数据。查看离线记录的软件将在稍后放出。导出的数据是 csv 格式，用户也可自行使用 Excel 等工具查看。

在主界面双击中键即可进入一般记录模式。

![保存位置](https://ooo.0o0.ooo/2016/08/24/57bdac2644692.bmp)

若已插入外部存储卡，则选择菜单中会有“存储卡”一项，如图所示。也可选择不保存记录。

![记录中主界面](https://ooo.0o0.ooo/2016/08/24/57bdbf40522ed.bmp)

若无意外，系统将进入记录模式。

若要停止记录，请在主界面双击中键。

![停止记录](https://ooo.0o0.ooo/2016/08/24/57bdac25f1c33.bmp)

停止后系统将保存记录文件（若选择了保存），然后显示统计信息。
[图片]
如图所示，系统将报告整个记录中的容量、电量、时间和平台电压。再次双击中键，即可返回主界面。

### 一般测试

在主界面短按右键，进入一般测试模式。

![选择模式](https://ooo.0o0.ooo/2016/08/24/57bdacfdb4699.bmp)

选择测试模式。

#### 恒电流测试模式
在恒电流模式下，负载电流恒定而不随电压变化。

![电流](https://ooo.0o0.ooo/2016/08/24/57bdab2f915f1.bmp)

设置测试电流， 设置范围 0 - 4A。 

>  *提示* 在这样的界面中，按左键减小数值，按右键增大数值，长按可以快速增减数值， 短按中键确认，双击中键放弃本次操作。

![保护电压](https://ooo.0o0.ooo/2016/08/24/57bda890d81f6.bmp)

设置保护电压， 当设备检测到电源电压低于此值时，将终止测试。保护电压的设置初值为当前电压的 90%（推荐使用）。

若当前电压低于保护值，系统会弹出“电压过低”提示框并回到主界面，无法继续测试。

![电压过低](https://ooo.0o0.ooo/2016/08/24/57bda5db2b119.bmp)

选择保存数据的存储器。若用户只期望获得测试的统计信息，也可以选择不保存。

![保存位置](https://ooo.0o0.ooo/2016/08/24/57bdac2644692.bmp)

 确认之后，系统将开始恒流测试。系统将会自动调整负载电流，待电流稳定时，测试开始。

![一般测试开始](https://ooo.0o0.ooo/2016/08/24/57bdacfdd0134.bmp)

恒流测试开始之后，设备将返回主界面。

![一般测试主界面](https://ooo.0o0.ooo/2016/08/24/57bdbed65536f.bmp)

主界面上将显示当前电压、电流、温度、容量、能量以及测试持续时间。如果已接入外部温度传感器，也将显示其温度。

> *提示*  若接入了外部温度传感器，外部温度传感器 的曲线数据也将被写入记录文件。

测试中，若电压低于保护电压，系统将立即停止测试并保存记录文件，然后弹出“已保护”提示框。

![保护](https://ooo.0o0.ooo/2016/08/24/57bdacfdd9c69.bmp)

系统将弹出测试统计信息，并用蜂鸣器报警，LED 闪烁，提示测试完成。

![测试统计信息](https://ooo.0o0.ooo/2016/08/24/57bdbf072cfda.bmp)

在主界面双击中键，也将停止测试。确认后，将弹出测试统计信息，双击中键可以回到主界面。

#### 恒功率测试模式

![功率](https://ooo.0o0.ooo/2016/08/24/57bda890d345e.bmp)

选择恒功率模式之后，设置功率，功率范围为 0 - 40W。
其他操作与恒流模式类似，不再赘述。

### 步进测试
步进测试模式下，测试器会逐步增加负载电流，从而反映前端电源的电压 - 电流关系。

在主界面短按左键，在设置参数后，即可开始步进测试。

![起始电流](https://ooo.0o0.ooo/2016/08/24/57bdab2fc8d0e.bmp)

设置起始电流。起始电流的设置范围为 0 - 4A。

![终止电流](https://ooo.0o0.ooo/2016/08/24/57bdab3012a47.bmp)

设置终止电流。终止电流最小为起始电流 + 0.1A，最大为 4A。

![步距](https://ooo.0o0.ooo/2016/08/24/57bda890c0355.bmp)

设置步距。步距的设置范围为 100mA - 500mA。

![时间间隔](https://ooo.0o0.ooo/2016/08/24/57bdab2fd154f.bmp)

设置时间间隔。时间间隔的设置范围为 2s - 30s。

![保护电压](https://ooo.0o0.ooo/2016/08/24/57bda890c39e6.bmp)

设置保护电压。

![步进测试进行中](https://ooo.0o0.ooo/2016/08/24/57bdc14c67b18.bmp)

系统进行步进测试时，屏幕将显示各项参数。

![浏览电流 / 电压数据](https://ooo.0o0.ooo/2016/08/24/57bda31c36898.bmp)

测试完成之后，设备将进入表格浏览模式，显示测试中各时间点的电流电压值。可以使用左右键来滚动。

![电流 / 电压曲线](https://ooo.0o0.ooo/2016/08/24/57bda5db03da4.bmp)

长按中键可以进入图像浏览模式，如图所示。使用左右键，浏览图像各点数据。

![查看模式](https://ooo.0o0.ooo/2016/08/24/57bda73ad5444.bmp)

短按中键可以在绘图模式和表格模式下切换。

![退出浏览](https://ooo.0o0.ooo/2016/08/24/57bdac25f006f.bmp)

在任意浏览模式下，双击中键都可退出浏览模式，返回主界面。

### 测试温度保护
设备具有三个温度传感器，一个用于监控 CPU 温度，一个用于监控 MOS 管温度，最后一个可以外接，用于监控并记录被测设备的温度。

尽管设备有一个散热风扇，且最大功率限制为 40W，但是在某些条件下，功率管温度仍然可能超过其承受范围。

测试中温度若超过温度限制，则系统会断开负载，暂停测试，并蜂鸣报警，温度降低到恢复门限之后， 测试继续进行。保护期间，测试记录暂停，离线文件也不会写入数据。 

![系统过热](https://ooo.0o0.ooo/2016/08/24/57bdbeaabbdc7.bmp)

在某些应用（如锂电池容量测试）中， 需要密切关注被测设备的温度。若被测设备的温度超出其承受范围，则可能影响被测设备的稳定性或导致损坏。本设备可以使用外部温度传感器，监测被测设备温度，保护被测设备。若未接入外部温度传感器，则外部温度保护不会生效。同样，在外部温度保护时，也会暂停测试。

![被测设备过热](https://ooo.0o0.ooo/2016/08/24/57bda31c2c104.bmp)

在设置中可以设置内 / 外保护温度及恢复门限。

### 导出测试数据

![挂载 USB 存储](https://ooo.0o0.ooo/2016/08/24/57bda73ad7c59.bmp)

连接电脑后，系统将弹出挂载提示，如图。

![磁盘界面](https://ooo.0o0.ooo/2016/08/24/57bdbb51b9cd8.png)

挂载后，设备如同一个 U 盘，可以方便地管理数据。

离线数据文件将被存放在根目录下的 Kanade\Record 目录内。

![USB 大容量存储](https://ooo.0o0.ooo/2016/08/24/57bda31c25120.bmp)

若要弹出 USB 大容量存储，请在先在电脑中“安全弹出设备”，然后单击中键。系统将回到主界面，资源管理器中的驱动器不再显示。

## 设置

![设置界面](https://ooo.0o0.ooo/2016/08/24/57bdab2fbe7ad.bmp)

在主界面长按中键，打开系统设置界面。

各设置项解释如下。

### 挂载和弹出存储卡
此选项仅供调试使用，本设备可以直接插入和拔出存储卡，无需进行其他操作。

若系统没有自动挂载存储卡，也可以用此选项手动挂载。

### 时间设置

![设置年份](https://ooo.0o0.ooo/2016/08/24/57bdab2fc1d24.bmp)

本设备具有一个实时时钟，该时钟由外部 32.768KHz 的爱普生晶振提供，因此具有较高的精度。
设备具有一个可充电纽扣锂电池，设备接入电源时，该电池自动完成充电，断电时，该电池为时钟提供电源。本设备可以持续掉电走时。

通过该设置项，用户可以设置时间，如图所示。接下来可继续设置年月日时分秒。

### 待机时钟设置
本设置项用于控制待机时钟的相关功能。

![待机时钟](https://ooo.0o0.ooo/2016/08/24/57bda5db00ccd.bmp)

选择第一个选项，可以开关待机时钟。

![待机时间](https://ooo.0o0.ooo/2016/08/24/57bda890b9c40.bmp)

设置进入待机时钟模式的时间。

### 温度保护设置

![系统保护温度](https://ooo.0o0.ooo/2016/08/24/57bdab3047209.bmp)

![外部保护温度](https://ooo.0o0.ooo/2016/08/24/57bdab2fd5d79.bmp)

可以设置功率管的保护温度、外部保护温度及保护门限。

![保护恢复门限](https://ooo.0o0.ooo/2016/08/24/57bda890ac9be.bmp)

保护恢复门限的范围为 5 - 20 ℃。

若保护恢复门限为 5 ℃，保护温度为 60 ℃，在 60 ℃ 时即会触发保护。当温度降到 60 - 5 = 55 ℃ 时，系统才会继续测试。

> **警告** 尽管允许的最高值为 125 ℃，但一般建议不超过 75 ℃。由于高温而造成的损坏，不在保修范围之内。

### Language（语言）

![Language](https://ooo.0o0.ooo/2016/08/24/57bdab2fcc9bf.bmp)

本设备目前支持四种语言， 英文，日文，简体中文，和繁体中文。该设置项可以设置语言。

This is a device with multi language support. English, Japanese, Simplified Chinese, Traditional Chinese are currently supported. 

To set device language, long press the middle key to enter 'Settings' page, browse down to the second page, set your language with the "Language" option. Japanese is currently with limited support.

To help with translations, just make a pull request, put up an issue or get in touch by E-mail on GitHub. We appreciate for your help.

### 磁盘格式化

![格式化](https://ooo.0o0.ooo/2016/08/24/57bdac2658e45.bmp)

若在测试中（带离线数据记录）异常断电或发现文件系统异常，可能是存储器文件系统损坏。可以通过格式化尝试修复故障。

> **警告** 存储器上的所有数据都会丢失。

此选项将会把选中存储器格式化为 FAT32 文件系统。

> *提示* 本设备只支持 FAT12 / 16 / 32 文件系统。若存储卡包含了其他文件系统（如 NTFS），本设备将无法读写此存储卡。

### 固件升级
本设备支持直接从内部存储器或 TF 卡中完成固件升级，无须其他设备（如烧写器）。
要进行固件升级，需要将固件文件（Kanade.moha）放入内部存储器或 TF 卡的根目录，然后选择“固件升级”。

![确认升级固件](https://ooo.0o0.ooo/2016/08/24/57bda73b5311c.bmp)

确认即可一键完成固件升级。

![更新固件](https://ooo.0o0.ooo/2016/08/24/57bda5db6b96c.bmp)

若固件升级失败或升级时断电，系统将无法启动。此时将固件拷入 TF卡中，在给设备上电之前按住左键，设备将进入如图所示界面。在该界面下，短按中键即可强行刷写固件，刷写后，系统便可以继续工作了。

![强制更新固件](https://ooo.0o0.ooo/2016/08/24/57bda5db64f3c.bmp)

若你想自己编译固件，请参考代码库中的编译指南。

> **警告** 可以自己使用 ST-LINK 刷写固件，但请谨慎操作。作者友情提供修复服务，但需要你承担由此带来的成本（如运费等）。

### 关于设备

![关于](https://ooo.0o0.ooo/2016/08/24/57bda73ad9d8c.bmp)

如图所示，用户可以进入系统信息界面，查看版本号，设计者，供应商等信息。

### 校准

![校准](https://ooo.0o0.ooo/2016/08/24/57bdac260f260.bmp)

本设备有三个校准模式，分别为运放自校准， 电压校准和电流校准。

由于某些原因，设备在使用一段时间后，可能在开始恒流测试时需要较长时间才能得到稳定的电流，在步进测试时看到电流调整较为困难（如 1A 负载，设备要经过好几秒钟才能得到稳定的 1.000A 电流）。若出现如上情况，则需要重新校准运放。

用户需要准备一个可输出 2A 以上电流的电源，将设备接入电源，然后进入校准菜单，选择“运放自校准”，系统便开始自动校准。 

![自校准](https://ooo.0o0.ooo/2016/08/24/57bdacfe3a41d.bmp)

等待20秒左右，若无意外，系统将弹出“校准成功”消息框。

![校准成功](https://ooo.0o0.ooo/2016/08/24/57bdac2632d8c.bmp)

若出现“校准失败”消息框，请检查前端电源的供电能力。

对于电压校准和电流校准，若无专业设备， 请勿进入，设备在出厂前已经做好了电压校准和电流校准工作，故本文档不再说明这两项内容。

## 硬件参数
### 测量范围与精度
#### 电压
- 量程 0 – 22 V
- 分辨率 0.1 mV
- 精度 0.1% ± 2字

#### 电流
- 量程 0 – 5 A
- 分辨率 0.1 mA
- 精度0.1% ± 2字

#### D+ D- 电压
- 量程 0 - 3.3V
- 分辨率 10 mV
- 精度 1% ± 2字

### 电子负载
#### 主要参数
- 最大功率 36 W
- 最大电流 4 A

#### 测试模式
- 步进测试
- 恒流测试
- 恒功率测试

#### 保护
- 自带温度传感器，保护功率 MOS 管
- 外接温度传感器，可设定保护温度以保护被测试设备
- 可编程电压跌落保护

### 快速充电触发与检测
#### 触发模式
- QC 2.0 5V/9V/12V/20V
- QC 3.0全电压
- MTK-PE全电压

#### 协议检测
- 高压快充（QC 2.0 / 3.0 / MTK-PE
- Apple 1A/2.1A/2.4A
- Android DCP

### 硬件特性
#### 处理/控制器 
- STM32 ARM Cortex-M3
	- 72 MHz主频
	- 64 KB RAM
	- 256 KB ROM

#### 采样 / 测试
- MCP3421 16bit ADC x 2（电压 / 电流测试）
- STM32 12bit ADC（USB D+ D- 测试）
- IRLZ44 晶体管

#### 存储
- 内置 8 MB Flash （支持 FAT32 文件系统）
- 扩展 TF 卡

#### 人机界面
- OLED 128x64 1.3寸显示屏
- 三段式拨轮按钮
- 蜂鸣器
- 全彩LED提示灯

#### 时钟
- 8 MHz 主晶振
- 32.768 KHz 高精度时钟晶振
- 可充电式纽扣电池，永久掉电走时

## 特别声明

本设备系电子 DIY 作品，作者无能力提供长期保修。在设备购买 1 个月内，若出现非人为因素、非不可抗力的故障，可寄回作者处免费修理。超过 1 个月的，若出现故障， 可视情况进行免费或付费修理，但作者不保证永久提供修理服务。

由于本设备固件升级方式简便安全，如果设备软件出现 bug 等，作者只提供修复固件，需要用户自行刷写。用户不得以软件问题为由退货或换新。同样地，作者不保证提供永久的软件更新服务。 

作者并不能保证设备不存在潜在的硬件缺陷， 对于购买 2 个月内出现的硬件缺陷，作者视情况提供相应补偿，对于购买 2 个月后出现的硬件缺陷，作者不保证能提供相应补偿，对于能够解决的硬件缺陷，作者会提供合理的解决方案。
 
由于作者时间有限，不能即时提供技术支持。若有任何疑问，用户应查阅本文档以解决，文档中未说明的，可向作者咨询，或在充电头论坛发帖询问。

若用户购买本产品，即视为同意以上条款。
